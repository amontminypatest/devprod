contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 5.0.0
    itemVersion: 1.3.12
    packID: PANWComprehensiveInvestigation
    packName: Comprehensive Investigation by Palo Alto Networks
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: "This playbook is triggered by a Palo Alto Networks Cortex threat alert,
  generated by Traps.  The playbook performs host enrichment for the source host with
  Palo Alto Networks Traps, enriches information for the suspicious file with Palo
  Alto Networks Minemeld and AutoFocus, and automatically performs file detonation
  for the extracted file. It then performs IOC enrichment with Minemeld for all related
  IOCs, and calculates the incident severity based on all the findings. In addition
  we detonate the file for the full analysis report. \nThe analyst can perform a manual
  memory dump for the suspected endpoint based on the incidentâ€™s severity, and choose
  to isolate the source endpoint with Traps.\nHunting tasks to find more endpoints
  that are infected is performed automatically based on a playbook input, and after
  all infected endpoints are found, remediation for all malicious IOCs is performed,
  including file quarantine, and IP and URLs blocking with Palo Alto Networks FireWall
  components such as Dynamic Address Groups and Custom URL Categories.\nAfter the
  investigation review the incident is automatically closed."
id: Palo Alto Networks - Endpoint Malware Investigation v3
inputs:
- description: This input accepts a comma-separated list of similar incident fields
    keys.
  key: similarIncidentFields
  playbookInputQuery: null
  required: false
  value: {}
- description: This input determines whether similar incidents that are found will
    be linked. Specify Yes/No.
  key: LinkSimilarIncidents
  playbookInputQuery: null
  required: false
  value: {}
- description: File SHA256.
  key: SHA256
  playbookInputQuery: null
  required: false
  value:
    complex:
      accessor: sha256
      root: incident
- description: A list of XDR endpoint IDs.
  key: endpoint_id_list
  playbookInputQuery: null
  required: false
  value: {}
- description: This input determines whether Palo Alto Networks Cortex XDR remediation
    will take place. Specify Yes/No
  key: UseXDR
  playbookInputQuery: null
  required: false
  value:
    simple: "Yes"
- description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall Dynamic Address Groups are used.
    Specify Dynamic Address Group tag name for IP handling.
  key: DAG
  playbookInputQuery: null
  required: false
  value: {}
- description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall Custom URL Categories are used.
    Specify Category name for URL handling.
  key: CustomURLCategory
  playbookInputQuery: null
  required: false
  value: {}
- description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall Custom block rules are used.
    Specify True to use Custom Block Rules.
  key: CustomBlockRule
  playbookInputQuery: null
  required: false
  value: {}
- description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall External Dynamic Lists are used for IP Blockage.
    Specify the EDL name for IP handling.
  key: IPListName
  playbookInputQuery: null
  required: false
  value: {}
- description: This input determines whether Palo Alto Networks Minemeld is used.
    Specify Miner name to update with the malicious indicators.
  key: Miner
  playbookInputQuery: null
  required: false
  value: {}
- description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall Static address groups are used.
    Specify Static address group name for IP handling.
  key: StaticAddressGroup
  playbookInputQuery: null
  required: false
  value: {}
- description: |-
    This input determines whether to commit the configuration automatically.
    Yes - Commit automatically.
    No - Commit manually.
  key: AutoCommit
  playbookInputQuery: null
  required: false
  value:
    simple: "No"
- description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall External Dynamic Lists are used for URL Blockage.
    Specify the EDL name for URL handling.
  key: URLListName
  playbookInputQuery: null
  required: false
  value: {}
- description: |-
    This input determines whether Palo Alto Networks Panorama or Firewall External Dynamic Lists are used:
    * The IP address of the web server on which the files are stored.
    * The web server IP address is configured in the integration instance.
  key: EDLServerIP
  playbookInputQuery: null
  required: false
  value: {}
- description: This input determines whether Palo Alto Networks Traps remediation
    will take place. Specify Yes/No.
  key: Traps
  playbookInputQuery: null
  required: false
  value:
    simple: "No"
- description: 'A list of internal IP ranges to check IP addresses against. The list
    should be provided in CIDR notation, separated by commas. An example of a list
    of ranges would be: "172.16.0.0/12,10.0.0.0/8,192.168.0.0/16" (without quotes).
    If a list is not provided, will use default list provided in the IsIPInRanges
    script (the known IPv4 private address ranges).'
  key: internal_range
  playbookInputQuery: null
  required: false
  value: {}
- description: The organizations internal domain name. This is provided for the script
    IsInternalHostName that checks if the detected host names are internal or external
    if the hosts contain the internal domains suffix. For example demisto.com. If
    there is more than one domain, use the | character to separate values such as
    (demisto.com|test.com)
  key: InternalDomainName
  playbookInputQuery: null
  required: false
  value: {}
- description: This is provided for the script IsInternalHostName that checks if the
    detected host names are internal or external. If the hosts match the organization's
    naming convention. For example the host testpc1 will have the following regex
    \w{6}\d{1}
  key: InternalHostRegex
  playbookInputQuery: null
  required: false
  value: {}
name: Palo Alto Networks - Endpoint Malware Investigation v3
outputs:
- contextPath: IP.Address
  description: IP addresses.
- contextPath: URL.Malicious.Description
  description: For malicious URLs, the reason that the vendor decided that the URL
    is malicious.
- contextPath: URL.Malicious
  description: Malicious URLs.
  type: unknown
- contextPath: File.Malicious.Description
  description: For malicious files, the reason that the vendor decided that the file
    is malicious.
starttaskid: "0"
system: true
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "114"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 7e7348f3-8938-44d7-8852-32ea5049e761
      iscommand: false
      name: ""
      version: -1
    taskid: 7e7348f3-8938-44d7-8852-32ea5049e761
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 480,
          "y": -120
        }
      }
  "5":
    continueonerrortype: ""
    id: "5"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "98"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: de384587-c7b4-4206-8387-51c7518971e2
      iscommand: false
      name: File Detonation
      type: title
      version: -1
    taskid: de384587-c7b4-4206-8387-51c7518971e2
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 760,
          "y": 1020
        }
      }
  "6":
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "77"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 7715d69b-1366-4bdf-8509-5344a5bf8a03
      iscommand: false
      name: File Enrichment
      type: title
      version: -1
    taskid: 7715d69b-1366-4bdf-8509-5344a5bf8a03
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 230,
          "y": 1020
        }
      }
  "10":
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "45"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 3d39667e-e2ae-4372-84b8-b70aca7b8f41
      iscommand: false
      name: False Positive
      type: title
      version: -1
    taskid: 3d39667e-e2ae-4372-84b8-b70aca7b8f41
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -330,
          "y": 2015
        }
      }
  "12":
    continueonerrortype: ""
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "137"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 6a41b9b1-69f6-4e1c-87ec-f1bf57987246
      iscommand: false
      name: Hunting for malicious indicators
      type: title
      version: -1
    taskid: 6a41b9b1-69f6-4e1c-87ec-f1bf57987246
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2080
        }
      }
  "20":
    continueonerrortype: ""
    id: "20"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      "no":
      - "130"
      "yes":
      - "129"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Manual review from the analyst.
      id: 294a5943-470f-46b0-82b7-353bb0bb7715
      iscommand: false
      name: Would you like to perform auto-remediation?
      type: condition
      version: -1
    taskid: 294a5943-470f-46b0-82b7-353bb0bb7715
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3080
        }
      }
  "34":
    continueonerror: true
    continueonerrortype: ""
    id: "34"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "121"
    note: false
    quietmode: 0
    scriptarguments:
      filter_data:
        simple: "False"
      sample_id:
        complex:
          root: inputs.SHA256
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Returns properties, behaviors, and activities observed for a sample.
        Run the command once to get the fields and operating systems under HTTP, Coverage,
        Behavior, Registry, Files, Processes, Connections, and DNS.
      id: 499e02e7-b80e-43db-8322-0ab08af88568
      iscommand: true
      name: AutoFocus - Retrieve Sample Analysis
      script: '|||autofocus-sample-analysis'
      type: regular
      version: -1
    taskid: 499e02e7-b80e-43db-8322-0ab08af88568
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 20,
          "y": 1350
        }
      }
  "45":
    continueonerrortype: ""
    id: "45"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: f566f0fa-83b3-45d9-8eb7-45d78b998878
      iscommand: false
      name: Done
      type: title
      version: -1
    taskid: f566f0fa-83b3-45d9-8eb7-45d78b998878
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 480,
          "y": 4180
        }
      }
  "48":
    continueonerrortype: ""
    id: "48"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      Close as False positive:
      - "10"
      continue:
      - "66"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Manual task for the analyst - continue with the investigation or
        close as a false positive.
      id: 1a5d1b4e-5b35-4969-8cea-d8d8daf2b50e
      iscommand: false
      name: Continue with the investigation or Close as False Positive?
      type: condition
      version: -1
    taskid: 1a5d1b4e-5b35-4969-8cea-d8d8daf2b50e
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1700
        }
      }
  "61":
    continueonerrortype: ""
    id: "61"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "121"
    note: false
    quietmode: 0
    scriptarguments:
      File:
        complex:
          root: File
      Interval:
        simple: "1"
      Timeout:
        simple: "15"
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: |-
        Detonate one or more files using the Wildfire integration. This playbook
        returns relevant reports to the War Room and file reputations to the context data.
        The detonation supports the following file types -
        APK, JAR, DOC, DOCX, RTF, XLS, XLSX, PPT, PPTX, OOXML, PE32, PDF, DMG, PKG, RAR, 7Z
      id: a0242e49-001e-4fe1-8fff-53682ae8f41c
      iscommand: false
      name: WildFire - Detonate file
      playbookId: WildFire - Detonate file
      type: playbook
      version: -1
    taskid: a0242e49-001e-4fe1-8fff-53682ae8f41c
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 760,
          "y": 1350
        }
      }
  "66":
    continueonerrortype: ""
    id: "66"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "12"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Manual task for the analyst - Perform manual Malware Analysis and
        Forensics.
      id: a8ebdc64-7543-4fb1-8bd0-6f8434e7ab49
      iscommand: false
      name: Perform manual Malware Analysis and Forensics
      type: regular
      version: -1
    taskid: a8ebdc64-7543-4fb1-8bd0-6f8434e7ab49
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1905
        }
      }
  "77":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: brand
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: Autofocus
                  - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: AutoFocus V2
                - - left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                root: modules
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "77"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "121"
      "yes":
      - "34"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check if AutoFocus integration is enabled.
      id: 159c7968-aeef-4692-8dac-6c44f83390d2
      iscommand: false
      name: Is AutoFocus Integration enabled?
      type: condition
      version: -1
    taskid: 159c7968-aeef-4692-8dac-6c44f83390d2
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 230,
          "y": 1180
        }
      }
  "91":
    continueonerrortype: ""
    id: "91"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "121"
    note: false
    quietmode: 0
    scriptarguments:
      endpoint_id_list:
        complex:
          root: inputs.endpoint_id_list
      hostname:
        complex:
          accessor: Hostname
          root: Endpoint
      ip_list:
        complex:
          accessor: Address
          root: IP
    separatecontext: false
    skipunavailable: true
    task:
      brand: Cortex XDR - IR
      description: Gets a list of endpoints, according to the passed filters. Filtering
        by multiple fields is concatenated using AND condition (OR is not supported).
        Maximum result set size is 100. Offset is the zero-based number of endpoint
        from the start of the result set (start by counting from 0).
      id: 93e5d156-d4ca-456b-8580-0b89cf69ec86
      iscommand: true
      name: Cortex XDR - get endpoints
      script: Cortex XDR - IR|||xdr-get-endpoints
      type: regular
      version: -1
    taskid: 93e5d156-d4ca-456b-8580-0b89cf69ec86
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -610,
          "y": 1350
        }
      }
  "98":
    continueonerrortype: ""
    id: "98"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "61"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Manual - Retrieve malicious file from the infected endpoint.
      id: 43a60709-a625-41b9-82ba-01f877032ee1
      iscommand: false
      name: Manual - Retrieve malicious file
      type: regular
      version: -1
    taskid: 43a60709-a625-41b9-82ba-01f877032ee1
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 760,
          "y": 1180
        }
      }
  "99":
    continueonerrortype: ""
    id: "99"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "100"
      - "135"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 5b391553-cad8-4f5f-8126-83a7fa8956b3
      iscommand: false
      name: Enrich Internal Indicators found
      type: title
      version: -1
    taskid: 5b391553-cad8-4f5f-8126-83a7fa8956b3
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2430
        }
      }
  "100":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: DetectedUsers
                root: PANWHunting
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "100"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "110"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: Palo Alto Minemeld
      description: Check if there are more IOCs to enrich?
      id: 529f8c4d-5d71-46fe-89ee-0570f1571a40
      iscommand: false
      name: Are there users to enrich?
      type: condition
      version: -1
    taskid: 529f8c4d-5d71-46fe-89ee-0570f1571a40
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 910,
          "y": 2570
        }
      }
  "101":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: DetectedInternalIPs
                root: PANWHunting
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "101"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "104"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: Palo Alto Minemeld
      description: Check if there are more IOCs to enrich?
      id: 7eeaf3bf-8ff0-41b0-87b9-650f6b3eb9e2
      iscommand: false
      name: Are there internal IP addresses to enrich?
      type: condition
      version: -1
    taskid: 7eeaf3bf-8ff0-41b0-87b9-650f6b3eb9e2
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -140,
          "y": 2740
        }
      }
  "104":
    continueonerrortype: ""
    id: "104"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "20"
    note: false
    quietmode: 0
    scriptarguments:
      ip_list:
        complex:
          accessor: DetectedExternalIPs
          root: PANWHunting
    separatecontext: false
    skipunavailable: false
    task:
      brand: Cortex XDR - IR
      description: Gets a list of endpoints, according to the passed filters. Filtering
        by multiple fields is concatenated using the AND condition (OR is not supported).
        Maximum result set size is 100. Offset is the zero-based number of endpoint
        from the start of the result set (start by counting from 0).
      id: c357e9bd-4307-4bb9-8c89-6815a4eed5e1
      iscommand: true
      name: Cortex XDR - get endpoints
      script: Cortex XDR - IR|||xdr-get-endpoints
      type: regular
      version: -1
    taskid: c357e9bd-4307-4bb9-8c89-6815a4eed5e1
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": -130,
          "y": 2910
        }
      }
  "106":
    continueonerrortype: ""
    id: "106"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "20"
    note: false
    quietmode: 0
    scriptarguments:
      username:
        complex:
          accessor: DetectedUsers
          root: PANWHunting
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Retrieves detailed information about a user account. The user can
        be specified by name, email address, or as an Active Directory Distinguished
        Name (DN). If no filter is specified, all users are returned.
      id: b6f9d8a3-0e4e-465d-8530-a475d8f8c40a
      iscommand: true
      name: Active Directory - get users
      script: '|||ad-get-user'
      type: regular
      version: -1
    taskid: b6f9d8a3-0e4e-465d-8530-a475d8f8c40a
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1310,
          "y": 2910
        }
      }
  "110":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: brand
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: Active Directory Query v2
                - - left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                root: modules
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "110"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "106"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check if the Active Directory integration is enabled.
      id: 5ad747ad-8337-4b41-8e81-0260b99c83af
      iscommand: false
      name: Is Active Directory integration enabled?
      type: condition
      version: -1
    taskid: 5ad747ad-8337-4b41-8e81-0260b99c83af
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1110,
          "y": 2740
        }
      }
  "114":
    continueonerrortype: ""
    id: "114"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "115"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 608f7fc8-7a26-4b9c-8718-f468f8d77e93
      iscommand: false
      name: Get similar incidents
      type: title
      version: -1
    taskid: 608f7fc8-7a26-4b9c-8718-f468f8d77e93
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 480,
          "y": 30
        }
      }
  "115":
    continueonerrortype: ""
    id: "115"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "120"
    note: false
    quietmode: 0
    scriptarguments:
      similarIncidentFields:
        complex:
          root: inputs.similarIncidentFields
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        Finds similar incidents by common incident keys, labels, custom fields or context keys.
        It's highly recommended to use incident keys if possible (e.g., "type" for the same incident type).
        For best performance, it's recommended to avoid using context keys whenever possible (for example, if the value also appears in a label key, use label).
      id: 39b3eb68-e1b9-44ea-818b-b6d767870047
      iscommand: false
      name: Find similar incidents
      script: FindSimilarIncidents
      type: regular
      version: -1
    taskid: 39b3eb68-e1b9-44ea-818b-b6d767870047
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 180
        }
      }
  "116":
    continueonerrortype: ""
    id: "116"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "126"
      - "5"
      - "6"
      - "128"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 835033fe-67fa-4038-8a65-3a44367d75cb
      iscommand: false
      name: Enrichment
      type: title
      version: -1
    taskid: 835033fe-67fa-4038-8a65-3a44367d75cb
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 480,
          "y": 880
        }
      }
  "118":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.LinkSimilarIncidents
                transformers:
                - operator: toLowerCase
          operator: isEqualString
          right:
            value:
              simple: "yes"
      - - left:
            iscontext: true
            value:
              complex:
                accessor: brand
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: Demisto REST API
                - - left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                root: modules
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "118"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "116"
      "yes":
      - "138"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Should the playbook link similar incidents?
      id: eda17ed0-e004-4fb9-8c3e-32fd9a50ffd4
      iscommand: false
      name: Link similar incidents?
      type: condition
      version: -1
    taskid: eda17ed0-e004-4fb9-8c3e-32fd9a50ffd4
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 270,
          "y": 540
        }
      }
  "120":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: isSimilarIncidentFound
                transformers:
                - operator: toLowerCase
          operator: isEqualString
          right:
            value:
              simple: "true"
      label: "yes"
    continueonerrortype: ""
    id: "120"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "116"
      "yes":
      - "118"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Were similar incidents found?
      id: 4eac6f25-ad32-4f7d-8b14-d2b4d73f1112
      iscommand: false
      name: Similar incidents found?
      type: condition
      version: -1
    taskid: 4eac6f25-ad32-4f7d-8b14-d2b4d73f1112
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 480,
          "y": 370
        }
      }
  "121":
    continueonerrortype: ""
    id: "121"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "48"
    note: false
    quietmode: 0
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 04f3e458-e77d-4f9c-8eb6-4de0b3199020
      iscommand: false
      name: Calculate Severity - Generic v2
      playbookId: Calculate Severity - Generic v2
      type: playbook
      version: -1
    taskid: 04f3e458-e77d-4f9c-8eb6-4de0b3199020
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1520
        }
      }
  "122":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: DetectedInternalHosts
                root: PANWHunting
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "122"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "123"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: Palo Alto Minemeld
      description: Check if there are more IOCs to enrich?
      id: 8f45b392-7ada-476b-862c-20b0f7fafb23
      iscommand: false
      name: Are there hosts to enrich?
      type: condition
      version: -1
    taskid: 8f45b392-7ada-476b-862c-20b0f7fafb23
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 310,
          "y": 2740
        }
      }
  "123":
    continueonerrortype: ""
    id: "123"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "20"
    note: false
    quietmode: 0
    scriptarguments:
      hostname:
        complex:
          accessor: DetectedInternalHosts
          root: PANWHunting
    separatecontext: false
    skipunavailable: false
    task:
      brand: Cortex XDR - IR
      description: Gets a list of endpoints, according to the passed filters. Filtering
        by multiple fields is concatenated using AND condition (OR is not supported).
        Maximum result set size is 100. Offset is the zero-based number of endpoint
        from the start of the result set (start by counting from 0).
      id: 38bc512b-9022-4c00-8c6f-dd41bc92b62c
      iscommand: true
      name: Cortex XDR - get endpoints
      script: Cortex XDR - IR|||xdr-get-endpoints
      type: regular
      version: -1
    taskid: 38bc512b-9022-4c00-8c6f-dd41bc92b62c
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 310,
          "y": 2910
        }
      }
  "125":
    continueonerrortype: ""
    id: "125"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "121"
    note: false
    quietmode: 0
    scriptarguments:
      username:
        complex:
          accessor: username
          root: incident
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Retrieves detailed information about a user account. The user can
        be specified by name, email address, or as an Active Directory Distinguished
        Name (DN). If no filter is specified, all users are returned.
      id: 9c31c831-afff-4b16-818a-6beac3ed1d4e
      iscommand: true
      name: Active Directory - get users
      script: '|||ad-get-user'
      type: regular
      version: -1
    taskid: 9c31c831-afff-4b16-818a-6beac3ed1d4e
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 1510,
          "y": 1350
        }
      }
  "126":
    continueonerrortype: ""
    id: "126"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "136"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: dfca392a-f3e3-4221-8144-f80fd52a0e5c
      iscommand: false
      name: User
      type: title
      version: -1
    taskid: dfca392a-f3e3-4221-8144-f80fd52a0e5c
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 1320,
          "y": 1020
        }
      }
  "127":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: brand
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: Cortex XDR - IR
                - - left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                root: modules
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "127"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "121"
      "yes":
      - "91"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check if the Cortex XDR integration is enabled.
      id: 78f4cb47-ab8a-4b52-80af-6efbed8d77d6
      iscommand: false
      name: Is Cortex XDR integration enabled?
      type: condition
      version: -1
    taskid: 78f4cb47-ab8a-4b52-80af-6efbed8d77d6
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -420,
          "y": 1180
        }
      }
  "128":
    continueonerrortype: ""
    id: "128"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "127"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: b55a8023-6bea-495d-8ce9-64270beedfc9
      iscommand: false
      name: Endpoint
      type: title
      version: -1
    taskid: b55a8023-6bea-495d-8ce9-64270beedfc9
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": -420,
          "y": 1020
        }
      }
  "129":
    continueonerrortype: ""
    id: "129"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "131"
    note: false
    quietmode: 0
    scriptarguments:
      AutoCommit:
        complex:
          root: inputs.AutoCommit
      CustomBlockRule:
        complex:
          root: inputs.CustomBlockRule
      CustomURLCategory:
        complex:
          root: inputs.CustomURLCategory
      DAG:
        complex:
          root: inputs.DAG
      EDLServerIP:
        complex:
          root: inputs.EDLServerIP
      IP:
        complex:
          accessor: Address
          filters:
          - - left:
                iscontext: true
                value:
                  simple: IP.Malicious
              operator: isExists
          root: IP
          transformers:
          - operator: uniq
      IPListName:
        complex:
          root: inputs.IPListName
      Miner:
        complex:
          root: inputs.Miner
      SHA256:
        complex:
          accessor: SHA256
          filters:
          - - left:
                iscontext: true
                value:
                  simple: File.Malicious
              operator: isExists
          root: File
          transformers:
          - operator: uniq
      StaticAddressGroup:
        complex:
          root: inputs.StaticAddressGroup
      Traps:
        complex:
          root: inputs.Traps
      URL:
        complex:
          accessor: Data
          filters:
          - - left:
                iscontext: true
                value:
                  simple: URL.Malicious
              operator: isExists
          root: URL
          transformers:
          - operator: uniq
      URLListName:
        complex:
          root: inputs.URLListName
      UseXDR:
        complex:
          root: inputs.UseXDR
      xdr_endpoint_id:
        complex:
          accessor: Endpoint.endpoint_id
          filters:
          - - left:
                iscontext: true
                value:
                  simple: PaloAltoNetworksXDR.Endpoint.endpoint_id
              operator: isExists
          root: PaloAltoNetworksXDR
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: This Playbook performs malicious IOC remediation using Palo Alto
        Networks integrations.
      id: b4e79165-862b-4a36-838d-2f06ef9cf653
      iscommand: false
      name: Palo Alto Networks - Malware Remediation
      playbookId: Palo Alto Networks - Malware Remediation
      type: playbook
      version: -1
    taskid: b4e79165-862b-4a36-838d-2f06ef9cf653
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 210,
          "y": 3250
        }
      }
  "130":
    continueonerrortype: ""
    id: "130"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "131"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Perform manual remediation.
      id: d477852b-e556-4944-8c81-68aa8d09a686
      iscommand: false
      name: Manual remediation
      type: regular
      version: -1
    taskid: d477852b-e556-4944-8c81-68aa8d09a686
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 760,
          "y": 3250
        }
      }
  "131":
    continueonerrortype: ""
    id: "131"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "132"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Manual review by the analyst.
      id: 41dfb52e-e47b-41a5-8fe5-d6acaa101edf
      iscommand: false
      name: Manual review by the analyst
      type: regular
      version: -1
    taskid: 41dfb52e-e47b-41a5-8fe5-d6acaa101edf
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3420
        }
      }
  "132":
    continueonerrortype: ""
    id: "132"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "133"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: |-
        A script to generate the investigation summary report in an automated way.
        Can be used in post-processing flow as well.
      id: 77d281c0-665c-47fd-8364-530c3a8ffe1a
      iscommand: false
      name: Generate investigation summary report
      script: GenerateInvestigationSummaryReport
      type: regular
      version: -1
    taskid: 77d281c0-665c-47fd-8364-530c3a8ffe1a
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3600
        }
      }
  "133":
    continueonerrortype: ""
    id: "133"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "134"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Manual - close investigation in the source product.
      id: 90332ba1-ee91-4862-87ee-983bd5895705
      iscommand: false
      name: Manual - close investigation in the source product
      type: regular
      version: -1
    taskid: 90332ba1-ee91-4862-87ee-983bd5895705
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3790
        }
      }
  "134":
    continueonerrortype: ""
    id: "134"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "45"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: Closes the investigation.
      id: bc108a8e-0c2d-413c-881b-b3655db2f28e
      iscommand: true
      name: Close Investigation
      script: Builtin|||closeInvestigation
      type: regular
      version: -1
    taskid: bc108a8e-0c2d-413c-881b-b3655db2f28e
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3980
        }
      }
  "135":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: brand
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: Cortex XDR - IR
                - - left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                root: modules
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "135"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "20"
      "yes":
      - "101"
      - "122"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check if the Cortex XDR integration is enabled.
      id: 5fa8d488-eeca-4213-8956-3a0e59872535
      iscommand: false
      name: Is Cortex XDR integration enabled?
      type: condition
      version: -1
    taskid: 5fa8d488-eeca-4213-8956-3a0e59872535
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 160,
          "y": 2570
        }
      }
  "136":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: brand
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: modules.brand
                    operator: isEqualString
                    right:
                      value:
                        simple: Active Directory Query v2
                - - left:
                      iscontext: true
                      value:
                        simple: modules.state
                    operator: isEqualString
                    right:
                      value:
                        simple: active
                root: modules
          operator: isExists
      label: "yes"
    continueonerrortype: ""
    id: "136"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "121"
      "yes":
      - "125"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Check if the Active Directory integration is enabled.
      id: d5928124-2a11-4286-899b-7f39669afddc
      iscommand: false
      name: Is Active Directory integration enabled?
      type: condition
      version: -1
    taskid: d5928124-2a11-4286-899b-7f39669afddc
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 1320,
          "y": 1180
        }
      }
  "137":
    continueonerrortype: ""
    id: "137"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "99"
    note: false
    quietmode: 0
    scriptarguments:
      IPAddresses:
        complex:
          accessor: Address
          filters:
          - - left:
                iscontext: true
                value:
                  simple: IP.Malicious
              operator: isExists
          - - left:
                iscontext: true
                value:
                  simple: IP.Adderss
              operator: IsNotInCidrRanges
              right:
                iscontext: true
                value:
                  simple: inputs.internal_range
          root: IP
          transformers:
          - operator: uniq
      InternalDomainName:
        complex:
          root: inputs.InternalDomainName
      InternalHostRegex:
        complex:
          root: inputs.InternalHostRegex
      InternalRange:
        complex:
          accessor: Address
          filters:
          - - left:
                iscontext: true
                value:
                  simple: IP.Address
              operator: IsInCidrRanges
              right:
                value:
                  simple: inputs.internal_range
          root: IP
          transformers:
          - operator: uniq
      MD5:
        complex:
          accessor: MD5
          filters:
          - - left:
                iscontext: true
                value:
                  simple: File.Malicious
              operator: isExists
          root: File
          transformers:
          - operator: uniq
      SHA1:
        complex:
          accessor: SHA1
          filters:
          - - left:
                iscontext: true
                value:
                  simple: File.Malicious
              operator: isExists
          root: File
          transformers:
          - operator: uniq
      SHA256:
        complex:
          accessor: SHA256
          filters:
          - - left:
                iscontext: true
                value:
                  simple: File.Malicious
              operator: isExists
          root: File
          transformers:
          - operator: uniq
      URLDomain:
        complex:
          accessor: Name
          filters:
          - - left:
                iscontext: true
                value:
                  simple: Domain.Name
              operator: isExists
          root: Domain
          transformers:
          - args:
              item:
                iscontext: true
                value:
                  simple: URL.Data
            operator: append
          - operator: uniq
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: "This is a multipurpose playbook used for hunting and threat detection.
        The playbook receives inputs based on hashes, IP addresses, or domain names
        provided manually or from outputs by other playbooks. \nWith the received
        indicators, the playbook leverages data received by PANW products including,
        Cortex Data Lake, Autofocus and Pan-OS to search for IP addresses, host names
        and users related to the provided indicators.\nThe output provided by the
        playbook facilitates pivoting searches for possibly affected IP addresses
        or users."
      id: 8ae7b534-5ede-441f-8ea2-53b39b33012a
      iscommand: false
      name: Palo Alto Networks - Hunting And Threat Detection
      playbookId: Palo Alto Networks - Hunting And Threat Detection
      type: playbook
      version: -1
    taskid: 8ae7b534-5ede-441f-8ea2-53b39b33012a
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 480,
          "y": 2240
        }
      }
  "138":
    continueonerrortype: ""
    id: "138"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "116"
    note: false
    quietmode: 0
    scriptarguments:
      incidentId:
        complex:
          accessor: id
          root: incident
      linkedIncidentIDs:
        complex:
          accessor: rawId
          root: similarIncident
    separatecontext: false
    skipunavailable: false
    task:
      brand: Builtin
      description: commands.local.cmd.linkIncidents
      id: a93f86c9-52aa-49c7-8894-ea950f9c294e
      iscommand: true
      name: Link similar incidents
      script: Builtin|||linkIncidents
      type: regular
      version: -1
    taskid: a93f86c9-52aa-49c7-8894-ea950f9c294e
    timertriggers: []
    type: regular
    view: |-
      {
        "position": {
          "x": 50,
          "y": 710
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {
      "100_20_#default#": 0.16,
      "101_20_#default#": 0.17,
      "110_20_#default#": 0.45,
      "118_116_#default#": 0.43,
      "120_116_#default#": 0.58,
      "120_118_yes": 0.58,
      "122_123_yes": 0.39,
      "127_121_#default#": 0.11,
      "48_10_Close as False positive": 0.59,
      "77_121_#default#": 0.36,
      "77_34_yes": 0.57
    },
    "paper": {
      "dimensions": {
        "height": 4365,
        "width": 2500,
        "x": -610,
        "y": -120
      }
    }
  }
